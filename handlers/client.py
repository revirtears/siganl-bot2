from aiogram import F, types
from aiogram.types import FSInputFile
from signature import BotSettings
from keyboards.client_kb import ReplyKb as kb

REQUIRED_CHANNEL = "@megatestbota"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∏–º—è –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞


class Client:
    def __init__(self, bot: BotSettings):
        self.bot = bot.bot
        self.dp = bot.dp
        self.db = bot.db


    async def register_handlers(self):
        self.dp.message(F.text.startswith("/start"))(self.start_handler)
        self.dp.callback_query(F.data == "acknowledge_registration")(self.confirm_registration_handler)
        self.dp.callback_query(F.data == "acknowledge_instructions")(self.acknowledge_instructions_handler)
        self.dp.callback_query(F.data == "check_subscription")(self.check_subscription_handler)
        self.dp.callback_query(F.data == "instruction")(self.instruction)
        self.dp.callback_query(F.data == "warning_handler")(self.warning_handler)

    async def check_subscription(self, user_id):
        try:
            member = await self.bot.get_chat_member(REQUIRED_CHANNEL, user_id)
            return member.status in ("member", "administrator", "creator")
        except Exception:
            return False

    async def ask_for_subscription(self, message):
        await message.answer(
            "‚ùóÔ∏è<b>–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª.</b>",
            reply_markup=await kb.subscription(REQUIRED_CHANNEL)
        )
        
    async def warning_handler(self, call: types.CallbackQuery):
        is_subscribed = await self.check_subscription(call.from_user.id)
        random_casino_link = f"https://1wsewz.com/?p=cygp&sub1={call.from_user.id}"
        
        if not is_subscribed:
            await self.ask_for_subscription(call.message)
            return
        await call.message.delete()
        await call.message.answer(
            """‚ö†Ô∏è<b>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</b>‚ö†Ô∏è

üî•<i>–ù–∞—à –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ç–æ–ª—å–∫–æ —Å –Ω–æ–≤—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –±–æ—Ç–µ</i>

‚ö°Ô∏è<b>–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç 1win —Ç–æ –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π</b>, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –±–æ—Ç –±—É–¥–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å –≤–∞–º –Ω–µ–≤–µ—Ä–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏ —É–∂–µ –∑–∞ —ç—Ç–æ –º—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–µ—Å—ë–º‚ùóÔ∏è

üí∏<b>–ñ–µ–ª–∞–µ–º –≤—Å–µ–º —É–¥–∞—á–∏, –∂–¥—ë–º –æ—Ç–∑—ã–≤–æ–≤ –æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞</b> !""",
            reply_markup=await kb.warning(casino_link=random_casino_link, webapp='https://rad-seahorse-749aaa.netlify.app/')
        )
        
        await self.db.set_warning(call.from_user.id)


    async def start_handler(self, m: types.Message):
        is_subscribed = await self.check_subscription(m.from_user.id)
        random_casino_link = f"https://1wsewz.com/?p=cygp&sub1={m.from_user.id}"

        if not is_subscribed:
            await self.ask_for_subscription(m)
            return

        user_exists = await self.db.user_exists(m.from_user.id)
        user_warning = await self.db.user_warning(m.from_user.id)
        is_ref_casino = await self.db.check_user_ref(m.from_user.id)
        registration_image_path = "photo/main_menu.jpg"
        registration_photo = FSInputFile(registration_image_path)

        if is_ref_casino:
            if user_warning:
                await self.bot.send_photo(
                    chat_id=m.chat.id,
                    photo=registration_photo,
                    
                    caption="""üëè–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º —Ç–µ–±—è –≤ 
‚ö°Ô∏èMEGAslot | <b>—Å–∏–≥–Ω–∞–ª—ã</b> 1WIN‚ö°Ô∏è

‚ùóÔ∏è–ù–∞—à –±–æ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ ChatGPT 4.0. ‚ùóÔ∏è–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ <b>–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–≥—Ä–∞—Ö –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä—ã 1win –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å ID –∞–∫–∫–∞—É–Ω—Ç–∞, —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏, –æ–±—â–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω</b>
–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –±–æ—Ç–µ –µ—Å—Ç—å –≤—Å–µ–≥–æ –æ–¥–Ω–∞ –∏–≥—Ä–∞ - minesü§ñ

üí£Mines - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Å–∞–ø—ë—Ä–∞ –≥–¥–µ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–µ –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –º–∏–Ω—É

üí∏<b>–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–∞—à–µ–º –±–æ—Ç–µ?</b>
ü§ñ–í—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ, –≤—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç –¥–ª—è –≤–∞—Å –±–æ—Ç

‚ùï<b>–í–∞–∂–Ω–æ –¥–ª—è —É–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</b>‚ùï
-–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –Ω–æ–≤—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏, <code>–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ</code> üëá 
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ üëá""",
                    reply_markup=await kb.main_menu("https://rad-seahorse-749aaa.netlify.app/", f"{random_casino_link}")
                )
                return
            else:
                await self.bot.send_photo(
                    chat_id=m.chat.id,
                    photo=registration_photo,
                    
                    caption="""üëè–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º —Ç–µ–±—è –≤ 
‚ö°Ô∏èMEGAslot | <b>—Å–∏–≥–Ω–∞–ª—ã</b> 1WIN‚ö°Ô∏è

‚ùóÔ∏è–ù–∞—à –±–æ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ ChatGPT 4.0. ‚ùóÔ∏è–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ <b>–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–≥—Ä–∞—Ö –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä—ã 1win –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å ID –∞–∫–∫–∞—É–Ω—Ç–∞, —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏, –æ–±—â–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω</b>
–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –±–æ—Ç–µ –µ—Å—Ç—å –≤—Å–µ–≥–æ –æ–¥–Ω–∞ –∏–≥—Ä–∞ - minesü§ñ

üí£Mines - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Å–∞–ø—ë—Ä–∞ –≥–¥–µ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–µ –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –º–∏–Ω—É

üí∏<b>–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–∞—à–µ–º –±–æ—Ç–µ?</b>
ü§ñ–í—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ, –≤—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç –¥–ª—è –≤–∞—Å –±–æ—Ç

‚ùï<b>–í–∞–∂–Ω–æ –¥–ª—è —É–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</b>‚ùï
-–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –Ω–æ–≤—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏, <code>–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ</code> üëá 
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ üëá""",
                    reply_markup=await kb.main_menu_warning(f"{random_casino_link}")
                )
                return

        command_parts = m.text.split(maxsplit=1)
        ref_code = None

        if len(command_parts) > 1:
            ref_code = await self.db.get_ref_code("t.me/onewintestbot?start=" + command_parts[1])
        
        instructions_image_path = "photo/inst.jpg"
        instructions_photo = FSInputFile(instructions_image_path)

        instructions = (
            "‚ùï<b>1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä–µ</b> <a href='https://1wqydy.top/?open=register&p=a993'>1WIN</a>\n"
            "–ï—Å–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ª—é–±—ã–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –í–ü–ù —Å–µ—Ä–≤–∏—Å–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: Planet VPN, Vpnify, FREE VPN fast. <b>–†–µ–≥–∏–æ–Ω - –®–≤–µ—Ü–∏—è</b>\n"
            "- ‚ùóÔ∏è–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ - <code>Florin12</code> - –æ–Ω –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É‚ùóÔ∏è\n"
            "\n"
            "-‚ùóÔ∏è<b>–ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–æ—Å—Ç—É–ø –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç</b>‚ùóÔ∏è\n"
            "\n"
            "‚ùï2. –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç 1WIN, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–π–¥–∏—Ç–µ —Å –Ω–µ–≥–æ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π. –ò–Ω–∞—á–µ –±–æ—Ç –≤—ã–¥–∞—Å—Ç –≤–∞–º –Ω–µ–≤–µ—Ä–Ω—ã–π —Å–∏–≥–Ω–∞–ª.\n"
            "<code>–°–∏–≥–Ω–∞–ª –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤–∞—à–µ–≥–æ ID –∞–∫–∫–∞—É–Ω—Ç–∞ 1WIN, —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏, –æ–±—â–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞</code>\n"
            "\n"
            "‚ùï3. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –≤–∞—à –±–∞–ª–∞–Ω—Å (–∑–∞–ø–æ–º–Ω–∏—Ç–µ —Å—É–º–º—É, –æ–Ω–∞ –≤–∞–º –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è).\n"
            "‚ùï4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª –∏–≥—Ä 1WIN –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ¬´<b>mines</b>¬ª.\n"
            "‚ùï5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≤—É—à–µ–∫ (–∑–∞–ø–æ–º–Ω–∏—Ç–µ —ç—Ç–æ —á–∏—Å–ª–æ, –æ–Ω–æ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞).\n"
            "‚ùï6. –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç ¬´<b>–ü–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª</b>¬ª. –ó–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –≤–∞—à ID –∞–∫–∫–∞—É–Ω—Ç–∞, —Å—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞, —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω.\n"
            "\n"
            "‚ùï7. <b>–ï—Å–ª–∏ –±–æ—Ç –æ—à–∏–±—Å—è, —É–¥–≤–æ–π—Ç–µ —Å—Ç–∞–≤–∫—É</b>.\n"
            "–ñ–µ–ª–∞–µ–º –≤—Å–µ–º —É–¥–∞—á–∏ –∏ –∂–¥—ë–º –æ—Ç–∑—ã–≤–æ–≤ –æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞!"
        )


        # Sending photo with fixed caption
        await self.bot.send_photo(
            m.chat.id,
            photo=instructions_photo,
            caption=instructions,
            parse_mode="HTML",
            reply_markup=await kb.registration()
        )


    async def confirm_registration_handler(self, cq: types.CallbackQuery):
        is_subscribed = await self.check_subscription(cq.from_user.id)

        if not is_subscribed:
            await cq.message.delete()
            await self.ask_for_subscription(cq.message)
            return

        user_exists = await self.db.user_exists(cq.from_user.id)
        random_casino_link = f"https://1wsewz.com/?p=cygp&sub1={cq.from_user.id}"
        instructions_image_path = "photo/reg.jpg"
        instructions_photo = FSInputFile(instructions_image_path)

        if not user_exists:
            await self.db.add_user(
                uid=cq.from_user.id,
                uname=cq.from_user.username if cq.from_user.username else cq.from_user.first_name
            )

        instructions = (
            "‚ùï<b>1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä–µ <a href='https://1wqydy.top/?open=register&p=a993'>1WIN</a> (—Å—Å—ã–ª–∫–∞ —Å–Ω–∏–∑—É üëá)</b>\n"
            "–ï—Å–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ª—é–±—ã–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –í–ü–ù —Å–µ—Ä–≤–∏—Å–æ–º, –∫ –ø—Ä–∏–º–µ—Ä—É: Planet VPN, Vpnify, FREE VPN fast. <b>–†–µ–≥–∏–æ–Ω - –®–≤–µ—Ü–∏—è</b>\n"
            "- ‚ùóÔ∏è–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ - <code>Florin12</code> - –æ–Ω –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É‚ùóÔ∏è\n"
            "\n"
            "-‚ùóÔ∏è<b>–ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–æ—Å—Ç—É–ø –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç</b>‚ùóÔ∏è\n"
            "‚ùï2. –î–∞–ª—å—à–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´<b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</b>¬ª –∏ —Å–ª–µ–¥—É–π—Ç–µ –ø–æ –≤—Å–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–º –ø—É–Ω–∫—Ç–∞–º")

        await cq.message.delete()
        await self.bot.send_photo(
            chat_id=cq.message.chat.id,
            photo=instructions_photo,
            caption=(
                instructions
            ), 
            
            reply_markup=await kb.accept(random_casino_link)
        )
        await cq.answer()
        await cq.answer()


    async def acknowledge_instructions_handler(self, cq: types.CallbackQuery):
        is_subscribed = await self.check_subscription(cq.from_user.id)
        random_casino_link = f"https://1wsewz.com/?p=cygp&sub1={cq.from_user.id}"
        user_warning = await self.db.user_warning(cq.from_user.id)
        is_ref_casino = await self.db.check_user_ref(cq.from_user.id)
        registration_image_path = "photo/main_menu.jpg"
        registration_photo = FSInputFile(registration_image_path)

        if not is_subscribed:
            await cq.message.delete()
            await self.ask_for_subscription(cq.message)
            return

        await cq.message.delete()

        if is_ref_casino:
        
            if user_warning:
                await self.bot.send_photo(
                    chat_id=cq.from_user.id,
                    photo=registration_photo,
                    
                    caption="""üëè–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º —Ç–µ–±—è –≤ 
‚ö°Ô∏èMEGAslot | <b>—Å–∏–≥–Ω–∞–ª—ã</b> 1WIN‚ö°Ô∏è

‚ùóÔ∏è–ù–∞—à –±–æ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ ChatGPT 4.0. ‚ùóÔ∏è–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ <b>–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–≥—Ä–∞—Ö –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä—ã 1win –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å ID –∞–∫–∫–∞—É–Ω—Ç–∞, —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏, –æ–±—â–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω</b>
–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –±–æ—Ç–µ –µ—Å—Ç—å –≤—Å–µ–≥–æ –æ–¥–Ω–∞ –∏–≥—Ä–∞ - minesü§ñ

üí£Mines - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Å–∞–ø—ë—Ä–∞ –≥–¥–µ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–µ –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –º–∏–Ω—É

üí∏<b>–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–∞—à–µ–º –±–æ—Ç–µ?</b>
ü§ñ–í—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ, –≤—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç –¥–ª—è –≤–∞—Å –±–æ—Ç

‚ùï<b>–í–∞–∂–Ω–æ –¥–ª—è —É–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</b>‚ùï
-–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –Ω–æ–≤—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏, <code>–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ</code> üëá 
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ üëá""",
                        reply_markup=await kb.main_menu("https://rad-seahorse-749aaa.netlify.app/", f"{random_casino_link}")
                )
                return
            else:
                await self.bot.send_photo(
                    chat_id=cq.from_user.id,
                    photo=registration_photo,
                    
                    caption="""üëè–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º —Ç–µ–±—è –≤ 
‚ö°Ô∏èMEGAslot | <b>—Å–∏–≥–Ω–∞–ª—ã</b> 1WIN‚ö°Ô∏è

‚ùóÔ∏è–ù–∞—à –±–æ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ ChatGPT 4.0. ‚ùóÔ∏è–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ <b>–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–≥—Ä–∞—Ö –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä—ã 1win –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å ID –∞–∫–∫–∞—É–Ω—Ç–∞, —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏, –æ–±—â–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω</b>
–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –±–æ—Ç–µ –µ—Å—Ç—å –≤—Å–µ–≥–æ –æ–¥–Ω–∞ –∏–≥—Ä–∞ - minesü§ñ

üí£Mines - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Å–∞–ø—ë—Ä–∞ –≥–¥–µ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–µ –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –º–∏–Ω—É

üí∏<b>–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–∞—à–µ–º –±–æ—Ç–µ?</b>
ü§ñ–í—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ, –≤—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç –¥–ª—è –≤–∞—Å –±–æ—Ç

‚ùï<b>–í–∞–∂–Ω–æ –¥–ª—è —É–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</b>‚ùï
-–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –Ω–æ–≤—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏, <code>–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ</code> üëá 
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ üëá""",
                        reply_markup=await kb.main_menu_warning(f"{random_casino_link}")
                )
                return
        else:
            instructions_image_path = "photo/inst.jpg"
            instructions_photo = FSInputFile(instructions_image_path)

            instructions = (
                "‚ùï<b>1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä–µ</b> <a href='https://1wqydy.top/?open=register&p=a993'>1WIN</a>\n"
                "–ï—Å–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ª—é–±—ã–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –í–ü–ù —Å–µ—Ä–≤–∏—Å–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: Planet VPN, Vpnify, FREE VPN fast. <b>–†–µ–≥–∏–æ–Ω - –®–≤–µ—Ü–∏—è</b>\n"
                "- ‚ùóÔ∏è–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ - <code>Florin12</code> - –æ–Ω –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É‚ùóÔ∏è\n"
                "\n"
                "-‚ùóÔ∏è<b>–ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–æ—Å—Ç—É–ø –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç</b>‚ùóÔ∏è\n"
                "\n"
                "‚ùï2. –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç 1WIN, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–π–¥–∏—Ç–µ —Å –Ω–µ–≥–æ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π. –ò–Ω–∞—á–µ –±–æ—Ç –≤—ã–¥–∞—Å—Ç –≤–∞–º –Ω–µ–≤–µ—Ä–Ω—ã–π —Å–∏–≥–Ω–∞–ª.\n"
                "<code>–°–∏–≥–Ω–∞–ª –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤–∞—à–µ–≥–æ ID –∞–∫–∫–∞—É–Ω—Ç–∞ 1WIN, —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏, –æ–±—â–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞</code>\n"
                "\n"
                "‚ùï3. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –≤–∞—à –±–∞–ª–∞–Ω—Å (–∑–∞–ø–æ–º–Ω–∏—Ç–µ —Å—É–º–º—É, –æ–Ω–∞ –≤–∞–º –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è).\n"
                "‚ùï4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª –∏–≥—Ä 1WIN –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ¬´<b>mines</b>¬ª.\n"
                "‚ùï5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≤—É—à–µ–∫ (–∑–∞–ø–æ–º–Ω–∏—Ç–µ —ç—Ç–æ —á–∏—Å–ª–æ, –æ–Ω–æ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞).\n"
                "‚ùï6. –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç ¬´<b>–ü–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª</b>¬ª. –ó–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –≤–∞—à ID –∞–∫–∫–∞—É–Ω—Ç–∞, —Å—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞, —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω.\n"
                "\n"
                "‚ùï7. <b>–ï—Å–ª–∏ –±–æ—Ç –æ—à–∏–±—Å—è, —É–¥–≤–æ–π—Ç–µ —Å—Ç–∞–≤–∫—É</b>.\n"
                "–ñ–µ–ª–∞–µ–º –≤—Å–µ–º —É–¥–∞—á–∏ –∏ –∂–¥—ë–º –æ—Ç–∑—ã–≤–æ–≤ –æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞!"
            )

            await self.bot.send_photo(
                cq.message.chat.id,
                photo=instructions_photo,
                caption=instructions,
                parse_mode="HTML",
                reply_markup=await kb.registration())

            
    async def instruction(self, cq: types.CallbackQuery):
        is_subscribed = await self.check_subscription(cq.from_user.id)

        if not is_subscribed:
            await cq.message.delete()
            await self.ask_for_subscription(cq.message)
            return
        
        instructions_image_path = "photo/inst.jpg"
        instructions_photo = FSInputFile(instructions_image_path)

        instructions = (
            "‚ùï<b>1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–æ—Ä–µ</b> <a href='https://1wqydy.top/?open=register&p=a993'>1WIN</a>\n"
            "–ï—Å–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ª—é–±—ã–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –í–ü–ù —Å–µ—Ä–≤–∏—Å–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: Planet VPN, Vpnify, FREE VPN fast. <b>–†–µ–≥–∏–æ–Ω - –®–≤–µ—Ü–∏—è</b>\n"
            "- ‚ùóÔ∏è–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ - <code>Florin12</code> - –æ–Ω –¥–∞—Å—Ç +500% –∫ –¥–µ–ø–æ–∑–∏—Ç—É‚ùóÔ∏è\n"
            "\n"
            "-‚ùóÔ∏è<b>–ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–æ—Å—Ç—É–ø –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç</b>‚ùóÔ∏è\n"
            "\n"
            "‚ùï2. –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç 1WIN, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–π–¥–∏—Ç–µ —Å –Ω–µ–≥–æ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π. –ò–Ω–∞—á–µ –±–æ—Ç –≤—ã–¥–∞—Å—Ç –≤–∞–º –Ω–µ–≤–µ—Ä–Ω—ã–π —Å–∏–≥–Ω–∞–ª.\n"
            "<code>–°–∏–≥–Ω–∞–ª –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤–∞—à–µ–≥–æ ID –∞–∫–∫–∞—É–Ω—Ç–∞ 1WIN, —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏, –æ–±—â–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞</code>\n"
            "\n"
            "‚ùï3. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –≤–∞—à –±–∞–ª–∞–Ω—Å (–∑–∞–ø–æ–º–Ω–∏—Ç–µ —Å—É–º–º—É, –æ–Ω–∞ –≤–∞–º –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è).\n"
            "‚ùï4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª –∏–≥—Ä 1WIN –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ¬´<b>mines</b>¬ª.\n"
            "‚ùï5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≤—É—à–µ–∫ (–∑–∞–ø–æ–º–Ω–∏—Ç–µ —ç—Ç–æ —á–∏—Å–ª–æ, –æ–Ω–æ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞).\n"
            "‚ùï6. –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç ¬´<b>–ü–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª</b>¬ª. –ó–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –≤–∞—à ID –∞–∫–∫–∞—É–Ω—Ç–∞, —Å—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞, —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω.\n"
            "\n"
            "‚ùï7. <b>–ï—Å–ª–∏ –±–æ—Ç –æ—à–∏–±—Å—è, —É–¥–≤–æ–π—Ç–µ —Å—Ç–∞–≤–∫—É</b>.\n"
            "–ñ–µ–ª–∞–µ–º –≤—Å–µ–º —É–¥–∞—á–∏ –∏ –∂–¥—ë–º –æ—Ç–∑—ã–≤–æ–≤ –æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞!"
        )

        await self.bot.send_photo(cq.from_user.id, photo=instructions_photo, caption=instructions, parse_mode="HTML")
        await cq.answer()

    async def check_subscription_handler(self, cq: types.CallbackQuery):
        is_subscribed = await self.check_subscription(cq.from_user.id)

        if is_subscribed:
            await cq.message.answer("‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª –∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞! –í–≤–µ–¥–∏—Ç–µ –µ—â–µ —Ä–∞–∑ <code>/start</code>")
        else:
            await cq.message.answer("‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞.")
